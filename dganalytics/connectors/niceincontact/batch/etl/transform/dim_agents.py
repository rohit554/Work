"""
This file contains the transformation logic for the `dim_agents` table in the Nice InContact data warehouse.
"""

from pyspark.sql import SparkSession

def dim_agents(spark: SparkSession, extract_date, extract_start_time, extract_end_time):
    """
    Transforms the raw agents data into the dimension table `dim_agents`.
    This function reads from the raw agents data and writes to the dimension table
    with necessary transformations.
    :param spark: SparkSession object
    :return: None
    """
    #override data in the dimension table
    spark.sql("""
        INSERT INTO dim_agents
        SELECT
            agentId,
            userName,
            firstName,
            middleName,
            lastName,
            userId,
            emailAddress,
            isActive,
            teamId,
            teamName,
            reportToId,
            reportToName,
            isSupervisor,
            lastLogin,
            lastUpdated,
            location,
            custom1,
            custom2,
            custom3,
            custom4,
            custom5,
            internalId,
            profileId,
            profileName,
            timeZone,
            country,
            countryName,
            state,
            city,
            chatRefusalTimeout,
            phoneRefusalTimeout,
            workItemRefusalTimeout,
            defaultDialingPattern,
            defaultDialingPatternName,
            useTeamMaxConcurrentChats,
            maxConcurrentChats,
            notes,
            createDate,
            inactiveDate,
            hireDate,
            terminationDate,
            hourlyCost,
            rehireStatus,
            employmentType,
            employmentTypeName,
            referral,
            atHome,
            hiringSource,
            ntLoginName,
            scheduleNotification,
            federatedId,
            useTeamEmailAutoParkingLimit,
            maxEmailAutoParkingLimit,
            sipUser,
            systemUser,
            systemDomain,
            crmUserName,
            useAgentTimeZone,
            timeDisplayFormat,
            sendEmailNotifications,
            apiKey,
            telephone1,
            telephone2,
            userType,
            isWhatIfAgent,
            timeZoneOffset,
            requestContact,
            chatThreshold,
            useTeamChatThreshold,
            emailThreshold,
            useTeamEmailThreshold,
            workItemThreshold,
            useTeamWorkItemThreshold,
            contactAutoFocus,
            useTeamContactAutoFocus,
            useTeamRequestContact,
            voiceThreshold,
            useTeamVoiceThreshold,
            recordingNumbers,
            subject,
            issuer,
            isOpenIdProfileComplete,
            teamUuid,
            maxPreview,
            deliveryMode,
            totalContactCount,
            useTeamDeliveryModeSettings,
            emailRefusalTimeout,
            voicemailRefusalTimeout,
            smsRefusalTimeout,
            isBillable,
            agentVoiceThreshold,
            agentChatThreshold,
            agentEmailThreshold,
            agentWorkItemThreshold,
            agentDeliveryMode,
            agentTotalContactCount,
            agentContactAutoFocus,
            agentRequestContact,
            agentMaxVersion,
            customerCard,
            locked,
            userNameDomain,
            combinedUserNameDomain,
            rowNumber,
            SmsThreshold,
            UseTeamsmsThreshold,
            LoginAuthenticatorId,
            DigitalThreshold,
            UseTeamDigitalThreshold,
            AgentPhoneTimeout,
            AgentPhoneTimeoutSeconds,
            address1,
            address2,
            zipCode,
            noFixedAddress,
            DigitalRefusalTimeout,
            agentCxaClientVersion,
            agentCxaReleasePrevious,
            stateCode,
            AgentIntegration,
            channelLock,
            extractDate,
            extractIntervalStartTime,
            extractIntervalEndTime
        FROM raw_agents
        """)
